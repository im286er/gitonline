<extend name="Public:common"/>
<block name="body">
<import type='js' file="Js.bdMap" />
<style type="text/css">
select {
    background: #f9f9f9 none repeat scroll 0 0;
    border-color: #666666 #cccccc #cccccc #666666;
    border-style: solid;
    border-width: 1px;
    color: #333333;
    padding: 2px;
    vertical-align: middle;
	height: 32px;
}
</style>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/Js/Kindeditor/themes/default/default.css" />
<div class="wrapper">
    <h2 class="title">分店管理/修改门店<input type="button" value="<返回" onClick="window.location.href='{:U('/Shop/index', '', true)}'"></h2>
    <div class="mian padding">
            <form action="__ACTION__" method="post" onsubmit="return checkForm();">    
        	<input type="hidden" value="{$shop.sid}" name="info[sid]">
			<input type="hidden" value="{$shop.jid}" name="info[jid]">
            <div class="set">
                <label>门店名称</label><input type="text" value="{$shop.sname}" name="info[sname]" placeholder="请输入门店名称">
            </div>
            <div class="set">
                <label>联系姓名</label><input type="text" value="{$shop.scontactsname}" name="info[scontactsname]" placeholder="请输入联系人姓名">
            </div>
            <div class="set">
                <label>联系电话</label><input type="text" value="{$shop.scontactstel}" name="info[scontactstel]" placeholder="请输入联系人电话">
            </div>
            <div class="set">
                <label>销售电话</label><input type="text" value="{$shop.msaletel}" name="info[msaletel]" placeholder="请输入销售电话">
            </div>
            <div class="set">
                <label>客服电话</label><input type="text" value="{$shop.mservetel}" name="info[mservetel]" placeholder="请输入客服电话">
            </div>
            <div class="set">
                <label>所在区域</label>
                <select id="SelectScity" name="info[province]">
                	<option value="">请选择区域省份</option>
                    <volist name='addressList' id='vo'>
                    <if condition="$vo['apid'] eq 0 AND  $vo['aid'] neq 0"><option value="{$vo.aid}" <if condition="$vo[aid] eq $shop[province]">selected</if>>{$vo.aname}</option></if>
                    </volist>
                </select>
            	<select id="SelectHcity" name="info[city]">
            	 <volist name='address1' id='vo1'>
                    <option value="{$vo1.aid}" <if condition="$vo1[aid] eq $shop[city] || $vo1[aid] eq $shop[district]">selected</if>>{$vo1.aname}</option>
                    </volist>
            	</select>
            	
                <select id="SelectQcity" <if condition="$address2"><else />style="display:none;"</if>，  name="info[district]">
                <volist name='address2' id='vo2'>
                    <option value="{$vo2.aid}" <if condition="$vo2[aid] eq $shop[district]">selected</if>>{$vo2.aname}</option>
                    </volist>
                </select>
            </div>
            <div class="set">
                <label>门店地址</label><input type="text" value="{$shop.saddress}" name="info[saddress]" placeholder="请输入门店地址">
            </div>
            <div class="set">
                <label>门店门景</label>
                <input type="text" value="{$shop.exterior}" name="info[exterior]" id="UPLOAD_EXTERIOR_VALUE" placeholder="请上传门店门景图" readonly="readonly">
                <input type="button" onclick="uploadImageFun()" value="上传门景" class="btn btn-pwd" />
            </div>
            
            <div class="set">
                <label>店内座位号</label> <input type="text" name="info[seatlist]" value="{$shop.seatlist}" placeholder="请输入座位号"><br />
                <p style="margin-left:44px; color:red;">温馨提示： 多个座位之前以英文","分隔，如： 1号,2号,3号,4号</p>
            </div>
            
            <div class="set">
                <label>门店简介</label><textarea name="info[mexplain]" placeholder="请输入门店简介" style="width:320px; height:70px; resize:none;">{$shop.mexplain}</textarea>
            </div>
            <div class="set">
                <label>APP客服</label><input type="text" value="{$shop.servernum}" name="info[servernum]" placeholder="门店APP客服数量,请填写1-9。"><br />
                <p style="margin-left:44px; color:red;">填写3,代表3个客服。例如：登录帐号为：dishu,客服帐号为：dishu:1,dishu:2,dishu:3,客服登录商家APP和分店密码相同。</p>
            </div>
            <div class="set">
                <label>门店坐标</label><input type="text" name="coordinates" <if condition="$shop['lng'] && $shop['lat']">value="{$shop.lng},{$shop.lat}"</if> placeholder="请在下方地图查找标注" autocomplete="on" id="coordinates" readonly = "readonly" style="background:#eeeeee;">
            </div>
            <div class="set">
				<label>地址模糊搜索</label>
				<input type="text" class="dfinput " name="saddress" id="search" value="{$va.saddress}" placeholder="请手动输入方便百度地图更好的查找！" />
				<input type="button" value="地图上找"  name="search_api" id="search_api" class="btn btn-pwd"  onClick="sear(document.getElementById('search').value);" >
			</div>
            <div class="map top"><div id="map1" style="height:350px;width:500px;border:1px solid #bcbcbc;"> </div></div>
			<script type="text/javascript">
			var mapx = '<if condition="$shop['lng'] && $shop['lat']">{$shop.lng},{$shop.lat}</if>';
			ShowMap("map1",{ismove:'1',mapx:mapx,piobj:'coordinates'});
			</script>
            <div class="set top">
                <input type="submit" class="btn btn-pwd" value="确认">
                <input type="button" class="btn btn-hui" value="修改"> 
            </div>
        </form>
        
<script type="text/javascript" src="__PUBLIC__/Js/Kindeditor/kindeditor.min.js"></script>
<script type="text/javascript">
var editor = KindEditor.editor({ uploadJson:"{:U('/Public/kindeditorUpload', '', true)}", imageUploadLimit:1, });

function uploadImageFun() {
	editor.loadPlugin('image', function() {
		editor.plugin.imageDialog({
			showRemote:false, 
			clickFn:function(url, title, width, height, border, align) {
				$('#UPLOAD_EXTERIOR_VALUE').val(url); editor.hideDialog();
			}
		});
		$(".ke-dialog-body").append('<div>温馨提示：图片大小不超过200K，规格：640 * 379，图片格式为 jpg,jpeg,png</div>');
	});	
}
</script>
        
        
        
		<script>
var reg=/^0?1[3|4|5|7|8][0-9]\d{8}$/;
var filter=/^(([0\+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/;
function checkForm(){
var sname=$("input[name='info[sname]']").val(); 
var scontactsname=$("input[name='info[scontactsname]']").val();
var scontactstel=$("input[name='info[scontactstel]']").val();
var mservetel=$("input[name='info[mservetel]']").val();
var msaletel=$("input[name='info[msaletel]']").val();
var saddress=$("input[name='info[saddress]']").val();
var mexplain=$("input[name='info[mexplain]']").val();
var mname=$("input[name='memb[mname]']").val();
var mpwd=$("input[name='memb[mpwd]']").val();
var servernum=$("input[name='info[servernum]']").val();
var coordinates=$("#coordinates").val();
if(sname==""){alert("门店名称不能为空！");return false;}
if(scontactsname==""){alert("联系人不能为空！");return false;}
if(scontactstel==""){alert("联系电话不能为空！");return false;}
 //联系电话格式
 
   	 if(reg.test(scontactstel)==false){
			
		   var ptel=filter.test(scontactstel); 
		   if(ptel==false){
			//alert("联系电话格式错误");  
			 // return false; 
		   }
		
 }
if(mservetel==""){alert("服务电话不能为空！");return false;}			

 //服务电话格式
   	 if(reg.test(mservetel)==false){
			
		   var ptel=filter.test(mservetel);
		   if(ptel==false){
			//alert("服务电话格式错误");  
			 //  return false;
		   }
		
			 }
if(msaletel==""){alert("销售电话不能为空！");return false;}
if(msaletel==""){return false;}
 //销售电话格式
   	 if(reg.test(msaletel)==false){
			
		   var ptel=filter.test(msaletel);
		   if(ptel==false){
			//alert("销售电话格式错误");  
			 // return false; 
		   }
		
			 }
			 var city = $("#SelectScity").val();
if(city==""){alert("所在区域不能为空！");return false;}	
if(saddress==""){alert("门店地址不能为空！");return false;}	
if(mexplain==""){alert("门店简介不能为空！");return false;}
if(mname==""){alert("门店管理账户不能为空！");return false;}
if(mpwd==""){alert("门店管理密码不能为空！");return false;}
if(servernum != ''){if(servernum>10){alert("客服数量最多为10人！");return false;}}
if(!coordinates){alert("门店地图没有标注哦！");return false;}
return true;
}


$(document).ready(function(e) {
    $("#UPLOAD_EXTERIOR_VALUE").click(function() {
		var image_src = $(this).val();
		if( !image_src ) return false;
		var KindeditorDialog = KindEditor.dialog({
			width : 700,
			height: 370,
			title : '预览图片',
			body  : '<img src="'+image_src+'" />',
			closeBtn : { name:'关闭', click:function(e) { KindeditorDialog.remove(); KindeditorDialog=null; } }
		});
	})
	$("#SelectScity").change(function() {
			var value = $(this).val(); SetAddressValue();
			if( value ) { $("#SelectQcity,#SelectHcity").hide(); $.get("{:U('/Shop/publicGetaddress', '', true)}", {pid:value}, function( data ) { 
				if(data) $("#SelectHcity").show(); else $("#SelectHcity").hide(); $("#SelectHcity").html( data ); SetAddressValue(); $.get("{:U('/Shop/publicGetaddress', '', true)}", {pid:$("#SelectHcity").val()}, function( data ) { 
				if(data) $("#SelectQcity").show(); else $("#SelectQcity").hide(); $("#SelectQcity").html( data ); SetAddressValue(); })
			})}
		})
		$("#SelectHcity").change(function() {
			var value = $(this).val(); SetAddressValue();
			if( value ) { $.get("{:U('/Shop/publicGetaddress', '', true)}", {pid:value,dval:''}, function( data ) { 
				if(data) $("#SelectQcity").show(); else $("#SelectQcity").hide(); $("#SelectQcity").html( data ); SetAddressValue(); 
			})}
		})
		$("#SelectQcity").change(function() { var value=$(this).val(); if( value ) { $("#ShopScity").val(value); } SetAddressValue(); })
});
function SetAddressValue() {
}
</script>
    </div>
</div>	
</block>